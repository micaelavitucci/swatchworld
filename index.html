<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Swatch World - Colores en la Nube</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 20px; 
            background: #f5f5f5; 
            color: #333;
        }
        h1 { color: #007bff; text-align: center; }
        h2 { color: #28a745; }
        #swatch-container { 
            display: flex; 
            flex-wrap: wrap; 
            gap: 10px; 
            margin: 20px 0; 
            min-height: 60px; 
            border: 1px dashed #ccc; 
            padding: 10px; 
            border-radius: 5px;
            background: white;
        }
        .swatch { 
            width: 50px; 
            height: 50px; 
            border: 2px solid #333; 
            border-radius: 5px; 
            cursor: pointer; 
            transition: transform 0.2s;
        }
        .swatch:hover { transform: scale(1.1); }
        button { 
            padding: 10px 20px; 
            margin: 5px; 
            background: #007bff; 
            color: white; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
            font-size: 16px;
        }
        button:hover { background: #0056b3; }
        button:active { background: #004085; }
        #status { 
            margin: 10px 0; 
            padding: 10px; 
            background: #d4edda; 
            border: 1px solid #c3e6cb; 
            border-radius: 5px; 
            color: #155724;
            display: none;
        }
        #error { 
            background: #f8d7da; 
            border: 1px solid #f5c6cb; 
            color: #721c24; 
            margin: 10px 0; 
            padding: 10px; 
            border-radius: 5px;
            display: none;
        }
        p { line-height: 1.5; }
    </style>
</head>
<body>
    <h1>🌈 Swatch World</h1>
    <p>Genera y guarda paletas de colores en la nube con Supabase.</p>
    
    <div>
        <button id="add-swatch">Agregar Swatch Aleatorio</button>
        <button id="clear-swatches">Borrar Todos</button>
    </div>
    
    <div id="status"></div>
    <div id="error"></div>
    
    <h2>Tus Swatches:</h2>
    <div id="swatch-container">Aún no hay swatches. ¡Agrega uno!</div>

    <!-- SDK Supabase PRIMERO -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
    
    <!-- JS COMPLETO: TODO DENTRO DE 'load' PARA ESPERAR SDK -->
    <script>
        window.addEventListener('load', function() {
            // 1. Configuración Supabase (REEMPLAZA CON TUS VALORES REALES DEL DASHBOARD)
            const supabaseUrl = 'https://bbrkgjhltcrscahjbumn.supabase.co';  // ← COPIA DE SUPABASE > SETTINGS > API > PROJECT URL
            const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJicmtnamhsdGNyc2NhaGpidW1uIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1OTY4MTM1NywiZXhwIjoyMDc1MjU3MzU3fQ.PAzFNwV4K0cfjNl3cFpx30tGpkY0o6OXdxysy38eMVo';  // ← COPIA DE SUPABASE > SETTINGS > API > ANON PUBLIC

            // 2. Verificar SDK y crear cliente
            if (typeof supabase === 'undefined') {
                console.error('SDK Supabase no cargó.');
                showStatus('Error: SDK no disponible. Revisa conexión.', true);
                return;
            }
            const client = supabase.createClient(supabaseUrl, supabaseKey);
            
            // 3. Variables globales
            const userId = 'micaelavitucci';
            let swatches = [];

            // 4. Función para status
            function showStatus(message, isError = false) {
                const status = document.getElementById('status');
                const error = document.getElementById('error');
                status.textContent = message;
                status.style.display = 'block';
                error.style.display = 'none';
                if (isError) {
                    error.textContent = message;
                    error.style.display = 'block';
                    status.style.display = 'none';
                }
            }

            // 5. Color aleatorio
            function randomColor() {
                return '#' + Math.floor(Math.random() * 16777215).toString(16).padStart(6, '0');
            }

            // 6. Renderizar swatches
            function renderSwatches() {
                const container = document.getElementById('swatch-container');
                container.innerHTML = '';
                if (swatches.length === 0) {
                    container.innerHTML = 'Aún no hay swatches. ¡Agrega uno!';
                    return;
                }
                swatches.forEach(color => {
                    const swatch = document.createElement('div');
                    swatch.className = 'swatch';
                    swatch.style.backgroundColor = color;
                    swatch.title = color;
                    container.appendChild(swatch);
                });
            }

            // 7. Cargar desde Supabase (CON LOGS DETALLADOS PARA DEBUG)
            async function loadSwatches() {
                showStatus('Cargando desde Supabase...');
                try {
                    const { data, error } = await client
                        .from('swatches')
                        .select('colors')
                        .eq('user_id', userId)
                        .single();

                    if (error && error.code !== 'PGRST116') throw error;

                    swatches = data ? data.colors : [];
                    renderSwatches();
                    showStatus(`¡Cargados ${swatches.length} swatches de la nube!`);
                } catch (error) {
                    console.error('Error al cargar - Código:', error.code);
                    console.error('Error al cargar - Mensaje:', error.message);
                    console.error('Error al cargar - Detalles:', error.details);
                    console.error('Error completo:', error);
                    showStatus('Error al conectar con la nube. Usando modo local.', true);
                    swatches = [];
                    renderSwatches();
                }
            }

            // 8. Guardar en Supabase (CON LOGS DETALLADOS)
            async function saveSwatches() {
                try {
                    const { error } = await client
                        .from('swatches')
                        .upsert({ user_id: userId, colors: swatches, updated: new Date().toISOString() });

                    if (error) throw error;
                    showStatus('¡Guardado en la nube exitosamente!');
                } catch (error) {
                    console.error('Error al guardar - Código:', error.code);
                    console.error('Error al guardar - Mensaje:', error.message);
                    console.error('Error al guardar - Detalles:', error.details);
                    console.error('Error completo:', error);
                    showStatus('Error al guardar en la nube.', true);
                }
            }

            // 9. Eventos de botones
            document.getElementById('add-swatch').addEventListener('click', () => {
                const color = randomColor();
                swatches.push(color);
                renderSwatches();
                saveSwatches();
            });

            document.getElementById('clear-swatches').addEventListener('click', () => {
                swatches = [];
                renderSwatches();
                saveSwatches();
            });

            // 10. Inicializar: Carga al final
            loadSwatches();
        });
    </script>
</body>
</html>


