<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Swatch World - Colores en la Nube</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 20px; 
            background: #f5f5f5; 
            color: #333;
        }
        h1 { color: #007bff; text-align: center; }
        h2 { color: #28a745; }
        #swatch-container { 
            display: flex; 
            flex-wrap: wrap; 
            gap: 10px; 
            margin: 20px 0; 
            min-height: 60px; 
            border: 1px dashed #ccc; 
            padding: 10px; 
            border-radius: 5px;
            background: white;
        }
        .swatch { 
            width: 50px; 
            height: 50px; 
            border: 2px solid #333; 
            border-radius: 5px; 
            cursor: pointer; 
            transition: transform 0.2s;
        }
        .swatch:hover { transform: scale(1.1); }
        button { 
            padding: 10px 20px; 
            margin: 5px; 
            background: #007bff; 
            color: white; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
            font-size: 16px;
        }
        button:hover { background: #0056b3; }
        button:active { background: #004085; }
        #status { 
            margin: 10px 0; 
            padding: 10px; 
            background: #d4edda; 
            border: 1px solid #c3e6cb; 
            border-radius: 5px; 
            color: #155724;
            display: none;
        }
        #error { 
            background: #f8d7da; 
            border: 1px solid #f5c6cb; 
            color: #721c24; 
            margin: 10px 0; 
            padding: 10px; 
            border-radius: 5px;
            display: none;
        }
        p { line-height: 1.5; }
    </style>
</head>
<body>
    <h1>üåà Swatch World</h1>
    <p>Genera y guarda paletas de colores en la nube con Supabase.</p>
    
    <div>
        <button id="add-swatch">Agregar Swatch Aleatorio</button>
        <button id="clear-swatches">Borrar Todos</button>
    </div>
    
    <div id="status"></div>
    <div id="error"></div>
    
    <h2>Tus Swatches:</h2>
    <div id="swatch-container">A√∫n no hay swatches. ¬°Agrega uno!</div>

    <!-- SDK Supabase PRIMERO -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
    
    <!-- JS COMPLETO: TODO DENTRO DE 'load' PARA ESPERAR SDK -->
    <script>
        <!-- Asegura que el SDK est√© en <head> o antes: -->
<!-- <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script> -->

<!-- JS COMPLETO: TODO DENTRO DE 'load' PARA ESPERAR SDK -->
<script>
    window.addEventListener('load', function() {
        // 1. Configuraci√≥n Supabase (CORREGIDO: ANON KEY P√öBLICA, NO SERVICE_ROLE)
        const supabaseUrl = 'https://bbrkgjhltcrscahjbumn.supabase.co';  // ‚Üê De SUPABASE > SETTINGS > API > PROJECT URL
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJicmtnamhsdGNyc2NhaGpidW1uIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk2ODEzNTcsImV4cCI6MjA3NTI1NzM1N30.6IjXsjEXn2wD2svy4tnDCwIheFCNQqFGz1Rl-zOmc_c';  // ‚Üê ANON PUBLIC (NO SERVICE_ROLE!)

        // 2. Verificar SDK y crear cliente (CORREGIDO: SINTAXIS V2)
        if (typeof supabase === 'undefined') {
            console.error('SDK Supabase no carg√≥.');
            showStatus('Error: SDK no disponible. Revisa conexi√≥n.', true);
            return;
        }
        const { createClient } = supabase;  // ‚Üê DESESTRUCTURACI√ìN PARA V2
        const client = createClient(supabaseUrl, supabaseKey);
        
        console.log('Cliente Supabase inicializado con key anon:', supabaseKey.substring(0, 20) + '...');  // ‚Üê DEBUG: Confirma key cargada

        // 3. Variables globales
        const userId = 'micaelavitucci';
        let swatches = [];

        // 4. Funci√≥n para cargar swatches (ejemplo si no la tienes; ajusta si existe)
        async function loadSwatches() {
            console.log('Cargando desde Supabase...');
            try {
                const { data, error } = await client
                    .from('swatches')
                    .select('colors')
                    .eq('user_id', userId)
                    .single();
                if (error) throw error;
                swatches = data ? data.colors || [] : [];
                console.log('¬°Cargados', swatches.length, 'swatches de la nube!', swatches);
                renderSwatches();  // ‚Üê Llama a tu funci√≥n de render
                showStatus('¬°Cargados desde la nube!', false);
            } catch (error) {
                console.error('Error al conectar:', error.message || error);
                swatches = [];  // Fallback local
                renderSwatches();
                showStatus('Modo local (error conexi√≥n).', true);
            }
        }

        // 5. Funci√≥n para guardar swatches (ejemplo si no la tienes)
        async function saveSwatches() {
            console.log('Guardando en Supabase...');
            try {
                const { error } = await client
                    .from('swatches')
                    .upsert({ user_id: userId, colors: swatches }, { onConflict: 'user_id' });
                if (error) throw error;
                console.log('¬°Guardado en la nube exitosamente!');
                showStatus('¬°Guardado en la nube!', false);
            } catch (error) {
                console.error('Error al guardar:', error.message || error);
                showStatus('Error al guardar. Intenta de nuevo.', true);
            }
        }

        // 6. Inicializar al cargar (llama loadSwatches al inicio)
        loadSwatches();  // ‚Üê Carga autom√°tica al abrir la app

        // 7. Ejemplos de eventos (ajusta a tus botones: ej. onclick="saveSwatches()")
        // Para bot√≥n "Generar Swatch": Agrega l√≥gica para push a swatches + saveSwatches()
        // Para "Borrar Todos": swatches = []; renderSwatches(); saveSwatches();
    });
</script>        
</body>
</html>



