<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Swatch World - Almacenamiento en Nube</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        #swatch-container { margin: 20px 0; }
        #swatch-container div { 
            width: 60px; height: 60px; display: inline-block; margin: 5px; 
            border: 2px solid #333; border-radius: 8px; color: #fff; 
            line-height: 60px; font-size: 12px; cursor: pointer;
        }
        button { padding: 10px 20px; margin: 10px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0056b3; }
        #status { color: #28a745; font-weight: bold; margin: 10px; }
        #error { color: #dc3545; }
    </style>
    <!-- SDK de Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>Swatch World con Supabase (Gratis)</h1>
    <p>Agrega colores y guárdalos en la nube. Se sincronizan al recargar.</p>
    <div id="swatch-container"></div>
    <br>
    <button id="add-swatch">Agregar Swatch Aleatorio</button>
    <button id="clear-swatches">Borrar Todos</button>
    <div id="status">Cargando...</div>
    <div id="error"></div>

    <script>
        // REEMPLAZA CON TUS CREDENCIALES DE SUPABASE (de Settings > API)
        const supabaseUrl = 'https://bbrkgjhltcrscahjbumm.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJicmtnamhsdGNyc2NhaGpidW1uIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk2ODEzNTcsImV4cCI6MjA3NTI1NzM1N30.6IjXsjEXn2wD2svy4tnDCwIheFCNQqFGz1Rl-zOmc_c';
        const supabase = Supabase.createClient(supabaseUrl, supabaseKey);

        const userId = 'micaelavitucci';  // Tu ID (puedes cambiarlo por un input de "usuario")
        let swatches = [];

        // Mostrar swatches
        function displaySwatches(colors) {
            const container = document.getElementById('swatch-container');
            container.innerHTML = '';
            colors.forEach((color, index) => {
                const div = document.createElement('div');
                div.style.backgroundColor = color;
                div.innerText = color.substring(1).toUpperCase();  // Muestra el hex sin #
                div.title = `Swatch ${index + 1}: ${color}`;
                container.appendChild(div);
            });
        }

        // Cargar de la nube
        async function loadSwatches() {
            const status = document.getElementById('status');
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = '';  // Limpia errores previos

            try {
                status.textContent = 'Cargando desde Supabase...';
                const { data, error } = await supabase
                    .from('swatches')
                    .select('colors')
                    .eq('user_id', userId)
                    .single();

                if (error && error.code !== 'PGRST116') {  // PGRST116 = no existe, OK
                    throw error;
                }

                swatches = data ? data.colors : [];
                displaySwatches(swatches);
                status.textContent = `¡Cargados ${swatches.length} swatches de la nube!`;
            } catch (error) {
                console.error('Error al cargar:', error);
                errorDiv.textContent = 'Error al conectar con la nube. Usando local.';
                swatches = [];
                displaySwatches(swatches);
            }
        }

        // Guardar en la nube
        async function saveSwatches() {
            const status = document.getElementById('status');
            try {
                const { error } = await supabase
                    .from('swatches')
                    .upsert({
                        user_id: userId,
                        colors: swatches,
                        updated: new Date().toISOString()
                    });

                if (error) throw error;
                status.textContent = '¡Guardado en la nube exitosamente!';
            } catch (error) {
                console.error('Error al guardar:', error);
                document.getElementById('error').textContent = 'Error al guardar. Revisa la consola.';
            }
        }

        // Inicializar
        loadSwatches();

        // Agregar swatch
        document.getElementById('add-swatch').addEventListener('click', () => {
            const newColor = '#' + Math.floor(Math.random() * 16777215).toString(16).padStart(6, '0');
            swatches.push(newColor);
            displaySwatches(swatches);
            saveSwatches();
        });

        // Borrar
        document.getElementById('clear-swatches').addEventListener('click', () => {
            swatches = [];
            displaySwatches(swatches);
            saveSwatches();
        });
    </script>
</body>
</html>


